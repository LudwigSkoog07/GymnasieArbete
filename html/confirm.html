<!doctype html>
<html lang="sv">
<head>
  <script src="../js/theme.js"></script>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Bekräftar konto…</title>
  <link rel="stylesheet" href="../css/Global.css">
  <style>
    .wrap{max-width:720px;margin:0 auto;padding:40px 16px}
    .card{
      background: var(--surface-strong);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 20px;
      box-shadow: var(--shadow-md);
      color: var(--text);
    }
    .muted{color: var(--text-muted);}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>Bekräftar konto…</h1>
      <p id="msg" class="muted">Vänta lite.</p>
    </div>
  </div>

  <!-- Cookie Banner -->
  <div id="cookieBanner" class="cookie-banner" role="dialog" aria-live="polite" aria-label="Cookie-meddelande">
    <p>
      Vi använder cookies för att förbättra upplevelsen. Genom att fortsätta
      accepterar du cookies.
    </p>
    <button id="cookieAccept" type="button">Acceptera</button>
  </div>

  <script type="module">
    import { supabase } from "../js/supabaseClient.js";

const msg = document.getElementById("msg");

async function run() {
  try {
    const url = new URL(window.location.href);

    // 1. Försök ta code (nya systemet)
    const code = url.searchParams.get("code");

    if (code) {
      await supabase.auth.exchangeCodeForSession(code);
      msg.textContent = "Klart! Konto bekräftat. Skickar vidare…";
      window.location.href = "Auth.html";
      return;
    }

    // 2. Försök ta access_token från hash (#)
    const hash = new URLSearchParams(window.location.hash.substring(1));
    const access_token = hash.get("access_token");
    const refresh_token = hash.get("refresh_token");

    if (access_token && refresh_token) {
      await supabase.auth.setSession({
        access_token,
        refresh_token,
      });

      msg.textContent = "Klart! Konto bekräftat. Skickar vidare…";
      window.location.href = "Auth.html";
      return;
    }

    // 3. Om inget hittas
    msg.textContent = "Saknar bekräftelsekod. Öppna länken från mailet igen.";
  } catch (e) {
    console.error(e);
    msg.textContent = "Fel vid bekräftelse. Försök igen.";
  }
}

run();
  </script>
  <script src="../js/cookie.js"></script>
</body>
</html>
